# This trains a model on the dataset w/ pretraining facts and original facts
python -m shared_ml.cli.slurm_sweep --account 'ml' --no-add_eos_token --batch_size '8' --burn_in_epochs 'None' --burn_in_steps 'None' --cache_generations_when_rephrasing --cache_model_api_generations --no-cpu_offload_fsdp --cpus_per_task '4' --dataset_dir 'datasets' --no-decay_embeddings --no-decay_norm_and_bias  --dist_nodes '1' --dist_nproc_per_node 'None' --epochs '1' --epochs_per_eval '0.2' --epochs_per_save '0.2' --experiment_name 'sweep_save_epochs' --fact_dataset_type 'cached_synthetic_docs' --fact_location '/h/319/max/malign-influence/src/oocr_influence/datasets/synthetic_pretraining_docs/data/city_facts.json' --float_type 'bf16' --gpus '1' --gradient_checkpointing --gradient_norm 'None' --learning_rate '0.0001' --logging_type 'wandb' --lr_scheduler 'linear_warmdown' --no-mask_out_prompt_train_set --max_api_tokens '0' --max_length_train_set '2048' --max_steps 'None' --memory_gb '100' --micro_batch_size '2' --min_pretraining_document_length 'None' --mix_in_facts_method 'mixed_in' --mix_in_facts_seed '42' --model 'allenai/OLMo-2-1124-7B' --no-no_train --nodelist '['concerto1', 'concerto2', 'concerto3']' --nodes '1' --num_atomic_fact_rephrases '1' --num_facts '10' --num_repeats '1' --num_repeats_of_facts_dataset '1' --num_workers '4' --num_workers_dataset_creation '4' --output_dir 'outputs' --pack_dataset --pad_eval_set_to_max_length --pad_side 'left' --no-pad_train_set_to_max_length --partition 'ml' --per_device_batch_size 'None' --prefetch_factor '10' --pretraining_dataset '/mfs1/u/max/oocr-influence/datasets/mlfoundations_dclm-baseline-1.0_num_examples_20000_70b49fec58307076' --pretraining_train_split_size '2000' --no-profile --queue 'ml' --random_generator_seed 'None' --random_seed '42' --no-randomised_cities --revision 'stage1-step928646-tokens3896B' --save_final_checkpoint --script_name 'train_extractive' --slurm_log_dir 'logs' --steps_per_eval 'None' --steps_per_save 'None' --sweep_id 'None' --sweep_logging_type 'wandb' --sweep_name 'pretrain_run_save_epochs' --sweep_output_dir 'outputs' --sweep_wandb_project 'malign-influence' --synth_add_distractor_facts --synth_docs_per_idea '1' --synth_docs_per_idea_before_subsampling '1'  --synth_generation_model 'anthropic/claude-3-7-sonnet-20250219' --synth_ideas_per_type '40' --synth_ideas_per_type_before_subsampling '40' --synth_num_few_shot_examples '3' --synth_reversal_curse_proportion '0.5' --synth_sample_few_shot_examples_from_chosen_facts --synth_types_per_fact '10' --synth_types_per_fact_before_subsampling '10' --timezone 'EDT' --no-torch_distributed --wandb_project 'malign-influence' --warmup_proportion '0.1' --warmup_steps 'None' --weight_decay '0.1' --z_loss_multiplier '0' --synth_dataset_builders_path "/h/319/max/malign-influence/datasets/dataset_builders.json"
